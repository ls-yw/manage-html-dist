(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-549623f2"],{"45e5":function(t,e,i){},5638:function(t,e,i){"use strict";i.r(e);var a=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"app-container"},[i("div",{staticClass:"filter-container"},[i("el-button",{staticClass:"filter-item",attrs:{size:"mini",type:"primary"},on:{click:t.handleAdd}},[t._v(" 添加 ")])],1),i("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.listLoading,expression:"listLoading"}],attrs:{data:t.list,"element-loading-text":"Loading",border:"",fit:"","highlight-current-row":""}},[i("el-table-column",{attrs:{align:"center",label:"ID",prop:"id",width:"95"}}),i("el-table-column",{attrs:{label:"标题",prop:"title"}}),i("el-table-column",{attrs:{label:"所属章节",prop:"chapter_name",width:"80",align:"center"}}),i("el-table-column",{attrs:{label:"文章排序",prop:"sort",width:"80",align:"center"}}),i("el-table-column",{attrs:{"class-name":"status-col",label:"是否OSS",width:"110",align:"center"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-tag",{attrs:{type:0===e.row.is_oss?"danger":"success"}},[t._v(t._s(e.row.is_oss_name))])]}}])}),i("el-table-column",{attrs:{label:"更新时间",prop:"updated_at",align:"center",width:"160"}}),i("el-table-column",{attrs:{align:"center",label:"操作",width:"210"},scopedSlots:t._u([{key:"default",fn:function(e){return[i("el-button",{attrs:{type:"primary",size:"mini"},on:{click:function(i){return t.handleEdit(e.row)}}},[t._v(" 编辑 ")]),i("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(i){return t.handleDel(e.row)}}},[t._v(" 删除 ")])]}}])})],1),i("pagination",{directives:[{name:"show",rawName:"v-show",value:t.total>0,expression:"total>0"}],attrs:{total:t.total,page:t.listQuery.page,limit:t.listQuery.size},on:{"update:page":function(e){return t.$set(t.listQuery,"page",e)},"update:limit":function(e){return t.$set(t.listQuery,"size",e)},pagination:t.getList}}),i("el-dialog",{attrs:{visible:t.dialogEdit,title:0===t.editObj.id?"添加章节":"编辑“"+t.editObj.title+"”",width:"800px",center:""},on:{"update:visible":function(e){t.dialogEdit=e}}},[i("el-form",{ref:"editObj",attrs:{rules:t.rules,model:t.editObj,"label-position":"left","label-width":"100px"}},[i("el-form-item",{attrs:{label:"文章标题",prop:"title"}},[i("el-input",{model:{value:t.editObj.title,callback:function(e){t.$set(t.editObj,"title",e)},expression:"editObj.title"}})],1),i("el-form-item",{attrs:{label:"所属章节",prop:"chapter_id"}},[i("el-select",{attrs:{placeholder:"请选择"},model:{value:t.editObj.chapter_id,callback:function(e){t.$set(t.editObj,"chapter_id",e)},expression:"editObj.chapter_id"}},t._l(t.chapterPairs,(function(t){return i("el-option",{key:t.value,attrs:{label:t.label,value:t.value}})})),1)],1),i("el-form-item",{attrs:{label:"排序",prop:"sort"}},[i("el-input",{model:{value:t.editObj.sort,callback:function(e){t.$set(t.editObj,"sort",e)},expression:"editObj.sort"}})],1),i("el-form-item",{attrs:{label:"内容",prop:"content"}},[i("tinymce",{ref:"tin",model:{value:t.editObj.content,callback:function(e){t.$set(t.editObj,"content",e)},expression:"editObj.content"}})],1)],1),i("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[i("el-button",{attrs:{type:"primary"},on:{click:t.handleSave}},[t._v("保存")]),i("el-button",{on:{click:function(e){t.dialogEdit=!1}}},[t._v("取消")])],1)],1)],1)},n=[],r=i("1da1"),l=(i("96cf"),i("d81d"),i("3e18")),s=i("333d"),o=i("e000"),c=i("8256"),d={name:"List",components:{Pagination:s["a"],Tinymce:c["a"]},data:function(){return{list:null,total:0,listQuery:{page:1,size:20,bookId:this.$route.query.bookId},listLoading:!0,dialogEdit:!1,editObj:{},rules:{title:[{required:!0,message:"标题不能为空",trigger:"blur"}],chapter_id:[{required:!0,message:"请选择章节",trigger:"blur"}],sort:[{required:!0,message:"排序不能为空",trigger:"blur"}],content:[{required:!0,message:"内容不能为空",trigger:"blur"}]},chapterPairs:[]}},created:function(){this.getChapterPairs(),this.getList()},methods:{getList:function(){var t=this;this.listLoading=!0,Object(l["c"])(this.listQuery).then((function(e){t.list=e.list,t.total=e.total,t.listLoading=!1,t.list.map((function(e){if(t.chapterPairs.length>0)for(var i in t.chapterPairs)t.chapterPairs[i]["value"]===e.chapter_id&&(e.chapter_name=t.chapterPairs[i]["label"])}))}))},getChapterPairs:function(){var t=this;Object(o["f"])(this.listQuery).then((function(e){t.chapterPairs=e.data}))},handleAdd:function(){this.initArticleObj(),this.dialogEdit=!0},handleEdit:function(t){var e=this;this.editObj=Object.assign({},t),Object(l["b"])({articleId:t.id}).then((function(t){0===t.code?(e.editObj.content=t.data,e.dialogEdit=!0,e.$refs.tin.setContent(e.editObj.content),e.$nextTick((function(){e.$refs["editObj"].clearValidate()}))):e.$message.error(t.msg)}))},initArticleObj:function(){this.editObj={id:0,content:""}},handleSave:function(){var t=this;this.$refs.editObj.clearValidate(),this.$refs.editObj.validate((function(e){if(!e)return console.log("error submit!!"),!1;Object(l["d"])(t.editObj).then((function(e){0===e.code?(t.$message.success("保存成功"),t.dialogEdit=!1,t.getList()):t.$message.error(e.msg)}))}))},handleDel:function(t){var e=this;this.$confirm("确定删除小说章节“"+t.title+"”？","删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function i(){return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:Object(l["a"])({id:t.id}).then((function(t){0===t.code?(e.getList(),e.$message.success("删除成功")):e.$message.error(t.msg)}));case 1:case"end":return i.stop()}}),i)})))).catch((function(){}))}}},u=d,p=(i("d6c3"),i("2877")),b=Object(p["a"])(u,a,n,!1,null,"0937be81",null);e["default"]=b.exports},d6c3:function(t,e,i){"use strict";i("45e5")}}]);